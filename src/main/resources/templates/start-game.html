<!DOCTYPE html>
<html lang="es" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Configurar Juego - Juego Escrituras LDS</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link th:href="@{/css/game.css}" rel="stylesheet">
    <meta name="description" content="Configuraci√≥n inicial para el juego de escrituras LDS">
</head>
<body class="bg-gradient">
<div class="container-fluid min-vh-100 d-flex align-items-center">
    <div class="container">
        <div class="row justify-content-center">
            <div class="col-md-6 col-lg-5">
                <div class="card shadow-lg game-card">
                    <div class="card-header bg-primary text-white text-center">
                        <h3 class="mb-1">üìö Configurar Nuevo Juego</h3>
                        <p class="mb-0 opacity-75">Dominio de Doctrina</p>
                    </div>
                    <div class="card-body p-4">
                        <!-- Game Configuration Form -->
                        <form th:action="@{/game/start}" method="post" id="gameConfigForm" novalidate>
                            <div class="mb-4">
                                <label for="playerName" class="form-label">
                                    <i class="bi bi-person"></i> Tu Nombre *
                                </label>
                                <input type="text"
                                       class="form-control"
                                       id="playerName"
                                       name="playerName"
                                       placeholder="Ingresa tu nombre completo"
                                       maxlength="50"
                                       required
                                       aria-describedby="playerNameHelp">
                                <div class="form-text" id="playerNameHelp">
                                    Tu nombre aparecer√° en el leaderboard y historial
                                </div>
                                <div class="invalid-feedback">
                                    Por favor ingresa tu nombre (2-50 caracteres)
                                </div>
                                <div class="valid-feedback">
                                    ¬°Perfecto!
                                </div>
                            </div>

                            <div class="mb-4" th:if="${books}">
                                <label for="bookType" class="form-label">
                                    <i class="bi bi-book"></i> Libro de Escrituras *
                                </label>
                                <select class="form-select"
                                        id="bookType"
                                        name="bookType"
                                        required
                                        aria-describedby="bookTypeHelp">
                                    <option value="">Selecciona un libro...</option>
                                    <option th:each="book : ${books}"
                                            th:value="${book.code}"
                                            th:text="${book.name}"
                                            th:data-description="${book.description}">Libro</option>
                                </select>
                                <div class="form-text" id="bookTypeHelp">
                                    Elige el libro de escrituras para tu sesi√≥n de estudio
                                </div>
                                <div class="invalid-feedback">
                                    Por favor selecciona un libro de escrituras
                                </div>
                            </div>

                            <!-- Difficulty Level (if available) -->
                            <div class="mb-4" th:if="${difficultyLevels}">
                                <label for="difficulty" class="form-label">
                                    <i class="bi bi-speedometer2"></i> Nivel de Dificultad
                                </label>
                                <select class="form-select" id="difficulty" name="difficulty">
                                    <option value="EASY" selected>üü¢ F√°cil - Preguntas b√°sicas</option>
                                    <option value="MEDIUM">üü° Intermedio - Preguntas moderadas</option>
                                    <option value="HARD">üî¥ Dif√≠cil - Preguntas avanzadas</option>
                                </select>
                                <div class="form-text">
                                    Puedes cambiar la dificultad en cualquier momento
                                </div>
                            </div>

                            <!-- Game Mode (if available) -->
                            <div class="mb-4" th:if="${gameModes}">
                                <label class="form-label">
                                    <i class="bi bi-controller"></i> Modo de Juego
                                </label>
                                <div class="row">
                                    <div class="col-12">
                                        <div class="form-check">
                                            <input class="form-check-input" type="radio" name="gameMode"
                                                   id="modeClassic" value="CLASSIC" checked>
                                            <label class="form-check-label" for="modeClassic">
                                                <strong>üéØ Cl√°sico</strong><br>
                                                <small class="text-muted">Preguntas de opci√≥n m√∫ltiple tradicionales</small>
                                            </label>
                                        </div>
                                    </div>
                                    <div class="col-12 mt-2" th:if="${gameModes.contains('SCRIPTURE_MASTERY')}">
                                        <div class="form-check">
                                            <input class="form-check-input" type="radio" name="gameMode"
                                                   id="modeScripture" value="SCRIPTURE_MASTERY">
                                            <label class="form-check-label" for="modeScripture">
                                                <strong>üìú Dominio de Escrituras</strong><br>
                                                <small class="text-muted">Enfoque en vers√≠culos de dominio</small>
                                            </label>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Submit Button -->
                            <div class="d-grid gap-2 mb-3">
                                <button type="submit"
                                        class="btn btn-success btn-lg"
                                        id="startGameBtn">
                                    üöÄ Comenzar Desaf√≠o
                                </button>
                            </div>
                        </form>

                        <!-- Navigation Links -->
                        <div class="row">
                            <div class="col-6">
                                <a th:href="@{/}" class="btn btn-outline-secondary w-100">
                                    ‚Üê Volver al Inicio
                                </a>
                            </div>
                            <div class="col-6">
                                <a th:href="@{/history}" class="btn btn-outline-info w-100">
                                    üìä Ver Historial
                                </a>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Quick Stats Card (if available) -->
                <div class="row mt-4" th:if="${playerStats}">
                    <div class="col-12">
                        <div class="card bg-light">
                            <div class="card-body">
                                <h6 class="card-title mb-3">üìà Tus Estad√≠sticas</h6>
                                <div class="row text-center">
                                    <div class="col-4">
                                        <h5 class="text-primary" th:text="${playerStats.totalGames}">0</h5>
                                        <small class="text-muted">Juegos</small>
                                    </div>
                                    <div class="col-4">
                                        <h5 class="text-success" th:text="${playerStats.bestScore}">0</h5>
                                        <small class="text-muted">Mejor Score</small>
                                    </div>
                                    <div class="col-4">
                                        <h5 class="text-warning" th:text="${#numbers.formatDecimal(playerStats.averageAccuracy, 1, 0)} + '%'">0%</h5>
                                        <small class="text-muted">Precisi√≥n</small>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Loading Modal -->
<div class="modal fade" id="loadingModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-sm modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-body text-center py-4">
                <div class="spinner-border text-primary mb-3" role="status">
                    <span class="visually-hidden">Configurando juego...</span>
                </div>
                <p class="mb-0">Preparando tu juego...</p>
            </div>
        </div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
<script th:src="@{/js/game.js}"></script>
<script>
    // Form validation
    (function() {
        'use strict';
        const form = document.getElementById('gameConfigForm');

        form.addEventListener('submit', function(event) {
            if (!form.checkValidity()) {
                event.preventDefault();
                event.stopPropagation();
            } else {
                // Show loading modal
                const loadingModal = new bootstrap.Modal(document.getElementById('loadingModal'));
                loadingModal.show();

                // Add loading state to button
                const startBtn = document.getElementById('startGameBtn');
                startBtn.innerHTML = '<span class="spinner-border spinner-border-sm me-2"></span>Configurando...';
                startBtn.disabled = true;
            }

            form.classList.add('was-validated');
        });

        // Real-time validation for player name
        const playerNameInput = document.getElementById('playerName');
        playerNameInput.addEventListener('input', function() {
            const value = this.value.trim();
            if (value.length >= 2 && value.length <= 50) {
                this.classList.remove('is-invalid');
                this.classList.add('is-valid');
            } else {
                this.classList.remove('is-valid');
                this.classList.add('is-invalid');
            }
        });

        // Book selection with descriptions
        const bookSelect = document.getElementById('bookType');
        if (bookSelect) {
            bookSelect.addEventListener('change', function() {
                const selectedOption = this.options[this.selectedIndex];
                const description = selectedOption.getAttribute('data-description');

                let helpText = document.getElementById('bookTypeHelp');
                if (description && description.length > 0) {
                    helpText.textContent = description;
                } else {
                    helpText.textContent = 'Elige el libro de escrituras para tu sesi√≥n de estudio';
                }
            });
        }
    })();

    // Auto-focus first input
    window.addEventListener('load', function() {
        const playerNameInput = document.getElementById('playerName');
        if (playerNameInput) {
            playerNameInput.focus();
        }
    });

    // Keyboard shortcuts
    document.addEventListener('keydown', function(e) {
        // Alt + Enter to submit form
        if (e.altKey && e.key === 'Enter') {
            const form = document.getElementById('gameConfigForm');
            if (form.checkValidity()) {
                form.submit();
            }
        }
    });
</script>
</body>
</html>